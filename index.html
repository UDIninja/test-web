<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>$UDI</title>

  <link rel="icon" href="UDifavicon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet"/>

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      background: #fd8c02;
      color: white;
      font-family: 'Special Elite', monospace;
      overflow-x: hidden;
    }

    /* ========== POLL WRAPPER ========== */
    .poll {
      position: relative;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .check-container {
      width: 100%;
      max-width: 460px;
      padding: 0 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      z-index: 2;
      gap: 12px;
    }

    .question {
      font-size: 1.1rem;
      letter-spacing: 1px;
      line-height: 1.4;
      padding: 14px 12px;
      border: 2px dashed rgba(255,255,255,0.6);
      border-radius: 12px;
      background: rgba(0,0,0,0.15);
    }

    /* ========== OPTION BOX ========== */
    .option-box {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      width: 260px;
      height: 340px;
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(6px);
      border: 2px solid white;
      border-radius: 16px;
      transition: left .35s ease, right .35s ease, box-shadow .25s ease, transform .2s ease;
      cursor: pointer;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .option-left { left: -235px; }
    .option-right { right: -235px; }

    /* Hover (desktop) */
    .option-left:hover { left: 16px; box-shadow: 0 0 22px rgba(255,255,255,0.7); }
    .option-right:hover { right: 16px; box-shadow: 0 0 22px rgba(255,255,255,0.7); }

    .option-left.active { left: 16px; }
    .option-right.active { right: 16px; }

    .arrow {
      position: absolute;
      font-size: 2.2rem;
      opacity: .35;
      transition: .2s ease;
      user-select: none;
    }

    .option-left .arrow { right: 10px; }
    .option-right .arrow { left: 10px; }

    .option-box:hover .arrow,
    .option-box.active .arrow { opacity: 0; }

    .option-content {
      opacity: 0;
      pointer-events: none;
      transition: .2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      width: 100%;
      height: 100%;
      justify-content: center;
      padding: 12px;
      text-align: center;
    }

    .option-box:hover .option-content,
    .option-box.active .option-content {
      opacity: 1;
      pointer-events: auto;
    }

    .option-content img {
      width: 140px;
      height: 140px;
      border-radius: 12px;
      border: 2px dashed rgba(255,255,255,.5);
      object-fit: cover;
      background: rgba(255,255,255,0.08);
    }

    .option-text { font-size: .9rem; letter-spacing: 1px; }
    .percent { font-size: .8rem; opacity: .8; }

    .locked { opacity: .25; pointer-events: none; }

    /* ========== MOBILE: disable hover glitch ========== */
    @media (hover: none) {
      .option-left:hover,
      .option-right:hover { box-shadow: none; }
    }

    /* ========== CONFIRM MODAL ========== */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .modal-box {
      background: black;
      border: 2px solid white;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      width: 280px;
    }

    .modal-buttons {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .modal-buttons button {
      width: 100%;
      padding: 8px 0;
      border-radius: 8px;
      border: 1px solid white;
      background: transparent;
      color: white;
      cursor: pointer;
      font-family: inherit;
    }
  </style>
</head>

<body>

  <!-- ========== POLL #1 ========== -->
  <section class="poll" data-poll-id="1">
    <!-- LEFT OPTION -->
    <div class="option-box option-left" id="leftBox-1" onclick="openConfirm(1, 'LEFT')">
      <div class="arrow">◀</div>
      <div class="option-content">
        <img src="" />
        <div class="option-text">LEFT OPTION</div>
        <div class="percent" id="leftPercent-1">0%</div>
      </div>
    </div>

    <!-- RIGHT OPTION -->
    <div class="option-box option-right" id="rightBox-1" onclick="openConfirm(1, 'RIGHT')">
      <div class="arrow">▶</div>
      <div class="option-content">
        <img src="" />
        <div class="option-text">RIGHT OPTION</div>
        <div class="percent" id="rightPercent-1">0%</div>
      </div>
    </div>

    <!-- QUESTION -->
    <div class="check-container">
      <div class="question">
        YOUR POLL QUESTION HERE
      </div>
    </div>
  </section>

  <!-- CONFIRM MODAL -->
  <div class="modal" id="confirmModal">
    <div class="modal-box">
      <div>Are you sure?</div>
      <div style="font-size:.8rem;opacity:.7;margin-top:6px">
        This choice cannot be changed.
      </div>
      <div class="modal-buttons">
        <button onclick="confirmVote()">YES</button>
        <button onclick="closeConfirm()">NO</button>
      </div>
    </div>
  </div>

  <script>
    let selected = { pollId: null, side: null };

    function getState(pollId) {
      return JSON.parse(localStorage.getItem("poll_" + pollId)) || { LEFT: 0, RIGHT: 0, userVote: null };
    }

    function setState(pollId, state) {
      localStorage.setItem("poll_" + pollId, JSON.stringify(state));
    }

    function updatePercent(pollId) {
      const state = getState(pollId);
      const total = state.LEFT + state.RIGHT || 1;
      document.getElementById("leftPercent-" + pollId).innerText =
        Math.round((state.LEFT / total) * 100) + "%";
      document.getElementById("rightPercent-" + pollId).innerText =
        Math.round((state.RIGHT / total) * 100) + "%";
    }

    function lockOptions(pollId) {
      const state = getState(pollId);
      const leftBox = document.getElementById("leftBox-" + pollId);
      const rightBox = document.getElementById("rightBox-" + pollId);

      if (state.userVote === "LEFT") {
        rightBox.classList.add("locked");
        leftBox.classList.add("active");
      } else if (state.userVote === "RIGHT") {
        leftBox.classList.add("locked");
        rightBox.classList.add("active");
      }
    }

    function openConfirm(pollId, side) {
      const state = getState(pollId);
      if (state.userVote) return alert("You already voted on this poll.");
      selected = { pollId, side };
      document.getElementById("confirmModal").style.display = "flex";
    }

    function closeConfirm() {
      selected = { pollId: null, side: null };
      document.getElementById("confirmModal").style.display = "none";
    }

    function confirmVote() {
      const { pollId, side } = selected;
      if (!pollId || !side) return;

      const state = getState(pollId);
      state[side] += 1;
      state.userVote = side;
      setState(pollId, state);

      document.getElementById("confirmModal").style.display = "none";
      lockOptions(pollId);
      updatePercent(pollId);
    }

    // init
    document.querySelectorAll(".poll").forEach(poll => {
      const pollId = poll.dataset.pollId;
      updatePercent(pollId);
      lockOptions(pollId);
    });

    /* ========== MOBILE SWIPE ========== */
    let startX = 0;
    document.addEventListener("touchstart", e => {
      startX = e.touches[0].clientX;
    });

    document.addEventListener("touchend", e => {
      const endX = e.changedTouches[0].clientX;
      const diff = endX - startX;

      if (Math.abs(diff) > 60) {
        const poll = document.querySelector(".poll"); // poll hiện tại
        const pollId = poll.dataset.pollId;

        if (diff > 0) {
          document.getElementById("leftBox-" + pollId).classList.add("active");
        } else {
          document.getElementById("rightBox-" + pollId).classList.add("active");
        }
      }
    });
  </script>
</body>
</html>
