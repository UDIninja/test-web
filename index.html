<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<title>$UDI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<link rel="icon" href="UDifavicon.png"/>
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet"/>
<script src="https://unpkg.com/ethers@6.10.0/dist/ethers.umd.min.js"></script>
<script src="https://unpkg.com/@walletconnect/ethereum-provider/dist/index.umd.js"></script>

<style>
body{margin:0;min-height:100vh;font-family:'Special Elite',monospace;color:#fff;background:url("bg.jpg") center/cover no-repeat fixed;overflow:hidden}
.overlay{min-height:100vh;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;position:relative}
.wallet{position:fixed;top:16px;left:50%;transform:translateX(-50%);padding:8px 14px;border:2px dashed #fff;border-radius:10px;cursor:pointer;background:rgba(0,0,0,.4)}
.vote-power{position:fixed;top:56px;left:50%;transform:translateX(-50%);font-size:.8rem}
.side{position:fixed;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:14px;transition:.4s}
.side.left{left:-260px}.side.right{right:-260px}
.side.left.active{left:20px}.side.right.active{right:20px}
.option{width:220px;height:130px;border:2px solid #fff;border-radius:14px;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.2s}
.option:hover{box-shadow:0 0 16px rgba(255,255,255,.8);transform:scale(1.03)}
.locked{opacity:.3;pointer-events:none}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center}
.modal-box{background:#000;border:2px solid #fff;border-radius:12px;padding:20px;text-align:center;width:260px}
.modal-box button{margin-top:8px;width:100%;padding:6px;background:transparent;border:1px solid #fff;color:#fff}
</style>
</head>

<body>
<div class="overlay">
  <div class="wallet" id="connectBtn">CONNECT WALLET</div>
  <div class="vote-power" id="votePowerText">Vote Power: 0</div>

  <div class="side left" id="leftSide">
    <div class="option" onclick="openVote(0)">A</div>
    <div class="option" onclick="openVote(1)">B</div>
  </div>
  <div class="side right" id="rightSide">
    <div class="option" onclick="openVote(2)">C</div>
    <div class="option" onclick="openVote(3)">D</div>
  </div>
</div>

<div class="modal" id="confirmModal">
  <div class="modal-box">
    Confirm vote?
    <button onclick="confirmVote()">YES</button>
    <button onclick="closeModal()">NO</button>
  </div>
</div>

<script>
const PROJECT_ID = "YOUR_WALLETCONNECT_PROJECT_ID";
const RPC_URL = "https://mainnet.infura.io/v3/YOUR_KEY";
const BACKEND = "https://your-backend.onrender.com";
const CONTRACT = "YOUR_VOTE_CONTRACT_ADDRESS";

let provider, signer, userAddress, votePower=0, choice=null;

window.onload=()=>{leftSide.classList.add("active");rightSide.classList.add("active");}

connectBtn.onclick = async () => {
  const wc = await window.WalletConnectEthereumProvider.init({
    projectId: PROJECT_ID, chains:[1], showQrModal:true, rpcMap:{1:RPC_URL}
  });
  await wc.enable();
  provider = new ethers.BrowserProvider(wc);
  signer = await provider.getSigner();
  userAddress = await signer.getAddress();
  connectBtn.innerText = userAddress.slice(0,6)+"..."+userAddress.slice(-4);

  const res = await fetch(BACKEND+"/vote-power/"+userAddress).then(r=>r.json());
  votePower = res.power;
  votePowerText.innerText = "Vote Power: " + votePower;
};

function openVote(c){ if(!votePower) return alert("No NFT"); choice=c; confirmModal.style.display="flex"; }
function closeModal(){ confirmModal.style.display="none"; }

async function confirmVote(){
  const abi = ["function vote(uint8 option,uint256 power)"];
  const contract = new ethers.Contract(CONTRACT, abi, signer);
  await contract.vote(choice, votePower);
  document.querySelectorAll(".option").forEach(o=>o.classList.add("locked"));
  closeModal();
}
</script>
</body>
</html>
